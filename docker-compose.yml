services:
     backend:
          container_name: media-sync-backend
          build:
               context: ./backend
               dockerfile: Dockerfile
          ports:
             - "3001:3001"
          environment:
             - PORT=3001
          networks:
             - sync-network
          restart: always

     frontend:
          container_name: media-sync-frontend
          build:
               context: ./frontend
               dockerfile: Dockerfile
               args:
                  - BACKEND_URL=${BACKEND_URL:-http://localhost:3001}
          ports:
             - "3000:3000"
          environment:
             - PORT=3000
             - ORIGIN=${ORIGIN:-http://localhost:3000}
          depends_on:
             - backend
          networks:
             - sync-network
          restart: always

     tunnel:
          container_name: media-sync-tunnel
          image: cloudflare/cloudflared:latest
          restart: always
          command: tunnel run
          environment:
             - TUNNEL_TOKEN=${CLOUDFLARE_TUNNEL_TOKEN}
          networks:
             - sync-network

networks:
     sync-network:
          driver: bridge
